<!DOCTYPE HTML>
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (11.0.14.1) on Tue Apr 26 12:43:33 UTC 2022 -->
<title>Main (IBM FHIR Server)</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="dc.created" content="2022-04-26">
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../jquery/jquery-ui.css" title="Style">
<script type="text/javascript" src="../../../../../script.js"></script>
<script type="text/javascript" src="../../../../../jquery/jszip/dist/jszip.min.js"></script>
<script type="text/javascript" src="../../../../../jquery/jszip-utils/dist/jszip-utils.min.js"></script>
<!--[if IE]>
<script type="text/javascript" src="../../../../../jquery/jszip-utils/dist/jszip-utils-ie.min.js"></script>
<![endif]-->
<script type="text/javascript" src="../../../../../jquery/jquery-3.5.1.js"></script>
<script type="text/javascript" src="../../../../../jquery/jquery-ui.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="Main (IBM FHIR Server)";
        }
    }
    catch(err) {
    }
//-->
var data = {"i0":10,"i1":10,"i2":10,"i3":10,"i4":10,"i5":10,"i6":10,"i7":10,"i8":10,"i9":10,"i10":10,"i11":10,"i12":10,"i13":10,"i14":10,"i15":10,"i16":10,"i17":10,"i18":10,"i19":10,"i20":10,"i21":10,"i22":10,"i23":10,"i24":10,"i25":10,"i26":10,"i27":10,"i28":10,"i29":10,"i30":10,"i31":10,"i32":10,"i33":10,"i34":10,"i35":10,"i36":10,"i37":9,"i38":10,"i39":10,"i40":10,"i41":10,"i42":10,"i43":10,"i44":10,"i45":10,"i46":10,"i47":10,"i48":10,"i49":10,"i50":10};
var tabs = {65535:["t0","All Methods"],1:["t1","Static Methods"],2:["t2","Instance Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
var pathtoroot = "../../../../../";
var useModuleDirectories = false;
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<header role="banner">
<nav role="navigation">
<div class="fixedNav">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a id="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/Main.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
</ul>
<div class="aboutLanguage"><a href="/FHIR" class="bx--header__name" target="_parent"><span>IBM</span>&nbsp;FHIRÂ®&nbsp;Server</a></div>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../index.html?com/ibm/fhir/schema/app/Main.html" target="_top">Frames</a></li>
<li><a href="Main.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<ul class="navListSearch">
<li><label for="search">SEARCH:</label>
<input type="text" id="search" value="search" disabled="disabled">
<input type="reset" id="reset" value="reset" disabled="disabled">
</li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a id="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
</div>
<div class="navPadding">&nbsp;</div>
<script type="text/javascript"><!--
$('.navPadding').css('padding-top', $('.fixedNav').css("height"));
//-->
</script>
</nav>
</header>
<!-- ======== START OF CLASS DATA ======== -->
<main role="main">
<div class="header">
<div class="subTitle"><span class="packageLabelInType">Package</span>&nbsp;<a href="package-summary.html">com.ibm.fhir.schema.app</a></div>
<h2 title="Class Main" class="title">Class Main</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>com.ibm.fhir.schema.app.Main</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<pre>public class <span class="typeNameLabel">Main</span>
extends java.lang.Object</pre>
<div class="block">Utility app to connect to a database and create/update the IBM FHIR Server schema.
 The DDL processing is idempotent, with only the necessary changes applied.
 <br>
 This utility also includes an option to exercise the tenant partitioning code.</div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- =========== FIELD SUMMARY =========== -->
<section role="region">
<ul class="blockList">
<li class="blockList"><a id="field.summary">
<!--   -->
</a>
<h3>Field Summary</h3>
<table class="memberSummary">
<caption><span>Fields</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colSecond" scope="col">Field</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static java.lang.String</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#ADMIN_SCHEMANAME">ADMIN_SCHEMANAME</a></span></code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static java.lang.String</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#BATCH_SCHEMANAME">BATCH_SCHEMANAME</a></span></code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static java.lang.String</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#DATA_SCHEMANAME">DATA_SCHEMANAME</a></span></code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>java.util.List&lt;<a href="../../database/utils/model/DbType.html" title="enum in com.ibm.fhir.database.utils.model">DbType</a>&gt;</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#MULTITENANT_FEATURE_ENABLED">MULTITENANT_FEATURE_ENABLED</a></span></code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static java.lang.String</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#OAUTH_SCHEMANAME">OAUTH_SCHEMANAME</a></span></code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>java.util.List&lt;<a href="../../database/utils/model/DbType.html" title="enum in com.ibm.fhir.database.utils.model">DbType</a>&gt;</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#PRIVILEGES_FEATURE_ENABLED">PRIVILEGES_FEATURE_ENABLED</a></span></code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>java.util.List&lt;<a href="../../database/utils/model/DbType.html" title="enum in com.ibm.fhir.database.utils.model">DbType</a>&gt;</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#STORED_PROCEDURE_ENABLED">STORED_PROCEDURE_ENABLED</a></span></code></th>
<td class="colLast">&nbsp;</td>
</tr>
</table>
</li>
</ul>
</section>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<section role="region">
<ul class="blockList">
<li class="blockList"><a id="constructor.summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="memberSummary">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Constructor</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tr class="altColor">
<th class="colConstructorName" scope="row"><code><span class="memberNameLink"><a href="#%3Cinit%3E()">Main</a></span>()</code></th>
<td class="colLast">&nbsp;</td>
</tr>
</table>
</li>
</ul>
</section>
<!-- ========== METHOD SUMMARY =========== -->
<section role="region">
<ul class="blockList">
<li class="blockList"><a id="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t1" class="tableTab"><span><a href="javascript:show(1);">Static Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t4" class="tableTab"><span><a href="javascript:show(8);">Concrete Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colSecond" scope="col">Method</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#addProperty(java.lang.String)">addProperty</a></span>&#8203;(java.lang.String&nbsp;pair)</code></th>
<td class="colLast">
<div class="block">Parse the given key=value string and add to the properties being collected</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#addTenantKey()">addTenantKey</a></span>()</code></th>
<td class="colLast">
<div class="block">Add a new tenant key so that we can rotate the values (add a
 new key, update config files, then remove the old key).</div>
</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code>protected void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#allocateTenant()">allocateTenant</a></span>()</code></th>
<td class="colLast">
<div class="block">Allocate this tenant, creating new partitions if required.</div>
</td>
</tr>
<tr id="i3" class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#applyDataMigrationForV0010()">applyDataMigrationForV0010</a></span>()</code></th>
<td class="colLast">
<div class="block">Perform the special data migration steps required for the V0010 version of the schema</div>
</td>
</tr>
<tr id="i4" class="altColor">
<td class="colFirst"><code>protected void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#applyDataMigrationForV0014()">applyDataMigrationForV0014</a></span>()</code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr id="i5" class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#applyModel(com.ibm.fhir.database.utils.model.PhysicalDataModel,com.ibm.fhir.database.utils.api.IDatabaseAdapter,com.ibm.fhir.task.api.ITaskCollector,com.ibm.fhir.database.utils.version.VersionHistoryService)">applyModel</a></span>&#8203;(<a href="../../database/utils/model/PhysicalDataModel.html" title="class in com.ibm.fhir.database.utils.model">PhysicalDataModel</a>&nbsp;pdm,
          <a href="../../database/utils/api/IDatabaseAdapter.html" title="interface in com.ibm.fhir.database.utils.api">IDatabaseAdapter</a>&nbsp;adapter,
          <a href="../../task/api/ITaskCollector.html" title="interface in com.ibm.fhir.task.api">ITaskCollector</a>&nbsp;collector,
          <a href="../../database/utils/version/VersionHistoryService.html" title="class in com.ibm.fhir.database.utils.version">VersionHistoryService</a>&nbsp;vhs)</code></th>
<td class="colLast">
<div class="block">Start the schema object creation tasks and wait for everything to complete</div>
</td>
</tr>
<tr id="i6" class="altColor">
<td class="colFirst"><code>protected void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#backfillResourceChangeLog()">backfillResourceChangeLog</a></span>()</code></th>
<td class="colLast">
<div class="block">Backfill the RESOURCE_CHANGE_LOG table if it is empty</div>
</td>
</tr>
<tr id="i7" class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#backfillResourceChangeLogDb2(com.ibm.fhir.schema.control.TenantInfo)">backfillResourceChangeLogDb2</a></span>&#8203;(<a href="../control/TenantInfo.html" title="class in com.ibm.fhir.schema.control">TenantInfo</a>&nbsp;ti)</code></th>
<td class="colLast">
<div class="block">backfill the resource_change_log table if it is empty</div>
</td>
</tr>
<tr id="i8" class="altColor">
<td class="colFirst"><code>protected void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#buildAdminSchemaModel(com.ibm.fhir.database.utils.model.PhysicalDataModel)">buildAdminSchemaModel</a></span>&#8203;(<a href="../../database/utils/model/PhysicalDataModel.html" title="class in com.ibm.fhir.database.utils.model">PhysicalDataModel</a>&nbsp;pdm)</code></th>
<td class="colLast">
<div class="block">Add the admin schema objects to the <a href="../../database/utils/model/PhysicalDataModel.html" title="class in com.ibm.fhir.database.utils.model"><code>PhysicalDataModel</code></a></div>
</td>
</tr>
<tr id="i9" class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#buildCommonModel(com.ibm.fhir.database.utils.model.PhysicalDataModel,boolean,boolean,boolean)">buildCommonModel</a></span>&#8203;(<a href="../../database/utils/model/PhysicalDataModel.html" title="class in com.ibm.fhir.database.utils.model">PhysicalDataModel</a>&nbsp;pdm,
                boolean&nbsp;addFhirDataSchema,
                boolean&nbsp;addOAuthSchema,
                boolean&nbsp;addJavaBatchSchema)</code></th>
<td class="colLast">
<div class="block">Build a common PhysicalDataModel containing all the requested schemas</div>
</td>
</tr>
<tr id="i10" class="altColor">
<td class="colFirst"><code>protected void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#buildFhirDataSchemaModel(com.ibm.fhir.database.utils.model.PhysicalDataModel)">buildFhirDataSchemaModel</a></span>&#8203;(<a href="../../database/utils/model/PhysicalDataModel.html" title="class in com.ibm.fhir.database.utils.model">PhysicalDataModel</a>&nbsp;pdm)</code></th>
<td class="colLast">
<div class="block">Add FHIR data schema objects to the given <a href="../../database/utils/model/PhysicalDataModel.html" title="class in com.ibm.fhir.database.utils.model"><code>PhysicalDataModel</code></a></div>
</td>
</tr>
<tr id="i11" class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#buildJavaBatchSchemaModel(com.ibm.fhir.database.utils.model.PhysicalDataModel)">buildJavaBatchSchemaModel</a></span>&#8203;(<a href="../../database/utils/model/PhysicalDataModel.html" title="class in com.ibm.fhir.database.utils.model">PhysicalDataModel</a>&nbsp;pdm)</code></th>
<td class="colLast">
<div class="block">Add the JavaBatch schema objects to the given <a href="../../database/utils/model/PhysicalDataModel.html" title="class in com.ibm.fhir.database.utils.model"><code>PhysicalDataModel</code></a></div>
</td>
</tr>
<tr id="i12" class="altColor">
<td class="colFirst"><code>protected void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#buildOAuthSchemaModel(com.ibm.fhir.database.utils.model.PhysicalDataModel)">buildOAuthSchemaModel</a></span>&#8203;(<a href="../../database/utils/model/PhysicalDataModel.html" title="class in com.ibm.fhir.database.utils.model">PhysicalDataModel</a>&nbsp;pdm)</code></th>
<td class="colLast">
<div class="block">Add the OAuth schema objects to the given <a href="../../database/utils/model/PhysicalDataModel.html" title="class in com.ibm.fhir.database.utils.model"><code>PhysicalDataModel</code></a></div>
</td>
</tr>
<tr id="i13" class="rowColor">
<td class="colFirst"><code>protected boolean</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#checkCompatibility()">checkCompatibility</a></span>()</code></th>
<td class="colLast">
<div class="block">specific feature to check if it is compatible.</div>
</td>
</tr>
<tr id="i14" class="altColor">
<td class="colFirst"><code>protected boolean</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#checkIfTenantNameAndTenantKeyExists(com.ibm.fhir.database.utils.db2.Db2Adapter,java.lang.String,java.lang.String,boolean)">checkIfTenantNameAndTenantKeyExists</a></span>&#8203;(<a href="../../database/utils/db2/Db2Adapter.html" title="class in com.ibm.fhir.database.utils.db2">Db2Adapter</a>&nbsp;adapter,
                                   java.lang.String&nbsp;tenantName,
                                   java.lang.String&nbsp;tenantKey,
                                   boolean&nbsp;skip)</code></th>
<td class="colLast">
<div class="block">checks if tenant name and tenant key exists.</div>
</td>
</tr>
<tr id="i15" class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#checkSchemaForTenant()">checkSchemaForTenant</a></span>()</code></th>
<td class="colLast">
<div class="block">Run a check to make sure that if the tenant already exists its schema
 matches the specified schema.</div>
</td>
</tr>
<tr id="i16" class="altColor">
<td class="colFirst"><code>protected void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#configureConnectionPool()">configureConnectionPool</a></span>()</code></th>
<td class="colLast">
<div class="block">Create a simple connection pool associated with our data source so that we
 can perform the DDL deployment in parallel</div>
</td>
</tr>
<tr id="i17" class="rowColor">
<td class="colFirst"><code>protected java.sql.Connection</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#createConnection()">createConnection</a></span>()</code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr id="i18" class="altColor">
<td class="colFirst"><code>protected void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#createSchemas()">createSchemas</a></span>()</code></th>
<td class="colLast">
<div class="block">Create the schemas</div>
</td>
</tr>
<tr id="i19" class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#deleteTenantMeta()">deleteTenantMeta</a></span>()</code></th>
<td class="colLast">
<div class="block">Delete all the metadata associated with the named tenant.</div>
</td>
</tr>
<tr id="i20" class="altColor">
<td class="colFirst"><code>protected void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#detachTenantPartitions(com.ibm.fhir.database.utils.model.PhysicalDataModel,com.ibm.fhir.schema.control.TenantInfo)">detachTenantPartitions</a></span>&#8203;(<a href="../../database/utils/model/PhysicalDataModel.html" title="class in com.ibm.fhir.database.utils.model">PhysicalDataModel</a>&nbsp;pdm,
                      <a href="../control/TenantInfo.html" title="class in com.ibm.fhir.schema.control">TenantInfo</a>&nbsp;tenantInfo)</code></th>
<td class="colLast">
<div class="block">Temporarily suspend RI so that tables which are the subject of foreign
 key relationships can have their partitions dropped.</div>
</td>
</tr>
<tr id="i21" class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#dropDetachedPartitionTables()">dropDetachedPartitionTables</a></span>()</code></th>
<td class="colLast">
<div class="block">Drop any tables which have previously been detached.</div>
</td>
</tr>
<tr id="i22" class="altColor">
<td class="colFirst"><code>protected void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#dropDetachedPartitionTables(com.ibm.fhir.database.utils.model.PhysicalDataModel,com.ibm.fhir.schema.control.TenantInfo)">dropDetachedPartitionTables</a></span>&#8203;(<a href="../../database/utils/model/PhysicalDataModel.html" title="class in com.ibm.fhir.database.utils.model">PhysicalDataModel</a>&nbsp;pdm,
                           <a href="../control/TenantInfo.html" title="class in com.ibm.fhir.schema.control">TenantInfo</a>&nbsp;tenantInfo)</code></th>
<td class="colLast">
<div class="block">Drop any tables which have previously been detached.</div>
</td>
</tr>
<tr id="i23" class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#dropSchema()">dropSchema</a></span>()</code></th>
<td class="colLast">
<div class="block">Drop all the objects in the admin and data schemas.</div>
</td>
</tr>
<tr id="i24" class="altColor">
<td class="colFirst"><code>protected void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#dropTenant()">dropTenant</a></span>()</code></th>
<td class="colLast">
<div class="block">Deallocate this tenant, dropping all the related partitions.</div>
</td>
</tr>
<tr id="i25" class="rowColor">
<td class="colFirst"><code>protected <a href="../control/TenantInfo.html" title="class in com.ibm.fhir.schema.control">TenantInfo</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#freezeTenant()">freezeTenant</a></span>()</code></th>
<td class="colLast">
<div class="block">Mark the tenant so that it can no longer be accessed (this prevents
 the SET_TENANT method from authenticating the tenantName/tenantKey
 pair, so the SV_TENANT_ID variable never gets set).</div>
</td>
</tr>
<tr id="i26" class="altColor">
<td class="colFirst"><code>protected int</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#getExitStatus()">getExitStatus</a></span>()</code></th>
<td class="colLast">
<div class="block">Get the program exit status from the environment</div>
</td>
</tr>
<tr id="i27" class="rowColor">
<td class="colFirst"><code>protected <a href="../control/TenantInfo.html" title="class in com.ibm.fhir.schema.control">TenantInfo</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#getTenantInfo()">getTenantInfo</a></span>()</code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr id="i28" class="altColor">
<td class="colFirst"><code>protected java.util.List&lt;<a href="../control/TenantInfo.html" title="class in com.ibm.fhir.schema.control">TenantInfo</a>&gt;</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#getTenantList()">getTenantList</a></span>()</code></th>
<td class="colLast">
<div class="block">Get the list of tenants and the schemas each is currently defined in.</div>
</td>
</tr>
<tr id="i29" class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#grantPrivileges()">grantPrivileges</a></span>()</code></th>
<td class="colLast">
<div class="block">Grant the minimum required set of privileges on the FHIR schema objects
 to the grantTo user.</div>
</td>
</tr>
<tr id="i30" class="altColor">
<td class="colFirst"><code>protected void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#grantPrivilegesForBatch()">grantPrivilegesForBatch</a></span>()</code></th>
<td class="colLast">
<div class="block">Apply grants to the JavaBatch schema objects</div>
</td>
</tr>
<tr id="i31" class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#grantPrivilegesForFhirData()">grantPrivilegesForFhirData</a></span>()</code></th>
<td class="colLast">
<div class="block">Apply grants to the FHIR data schema objects</div>
</td>
</tr>
<tr id="i32" class="altColor">
<td class="colFirst"><code>protected void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#grantPrivilegesForOAuth()">grantPrivilegesForOAuth</a></span>()</code></th>
<td class="colLast">
<div class="block">Apply grants to the OAuth schema objects</div>
</td>
</tr>
<tr id="i33" class="rowColor">
<td class="colFirst"><code>protected boolean</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#isMultitenant()">isMultitenant</a></span>()</code></th>
<td class="colLast">
<div class="block">Do we want to build the multitenant variant of the schema (currently only supported
 by DB2)</div>
</td>
</tr>
<tr id="i34" class="altColor">
<td class="colFirst"><code>protected void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#listTenants()">listTenants</a></span>()</code></th>
<td class="colLast">
<div class="block">List the tenants currently configured</div>
</td>
</tr>
<tr id="i35" class="rowColor">
<td class="colFirst"><code>void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#loadPropertyFile(java.lang.String)">loadPropertyFile</a></span>&#8203;(java.lang.String&nbsp;filename)</code></th>
<td class="colLast">
<div class="block">Read the properties from the given file</div>
</td>
</tr>
<tr id="i36" class="altColor">
<td class="colFirst"><code>protected void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#logStatusMessage(int)">logStatusMessage</a></span>&#8203;(int&nbsp;status)</code></th>
<td class="colLast">
<div class="block">Write a final status message - useful for QA to review when checking the
 output</div>
</td>
</tr>
<tr id="i37" class="rowColor">
<td class="colFirst"><code>static void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#main(java.lang.String%5B%5D)">main</a></span>&#8203;(java.lang.String[]&nbsp;args)</code></th>
<td class="colLast">
<div class="block">Main entry point</div>
</td>
</tr>
<tr id="i38" class="altColor">
<td class="colFirst"><code>protected void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#parseArgs(java.lang.String%5B%5D)">parseArgs</a></span>&#8203;(java.lang.String[]&nbsp;args)</code></th>
<td class="colLast">
<div class="block">Parse the command-line arguments, building up the environment and
 establishing
 the run-list</div>
</td>
</tr>
<tr id="i39" class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#populateResourceTypeAndParameterNameTableEntries(java.lang.Integer)">populateResourceTypeAndParameterNameTableEntries</a></span>&#8203;(java.lang.Integer&nbsp;tenantId)</code></th>
<td class="colLast">
<div class="block">populates for the given tenantId the RESOURCE_TYPE table.</div>
</td>
</tr>
<tr id="i40" class="altColor">
<td class="colFirst"><code>protected void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#process()">process</a></span>()</code></th>
<td class="colLast">
<div class="block">Process the requested operation</div>
</td>
</tr>
<tr id="i41" class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#refreshTenants()">refreshTenants</a></span>()</code></th>
<td class="colLast">
<div class="block">Make sure all the tables has a partition created for the configured tenant</div>
</td>
</tr>
<tr id="i42" class="altColor">
<td class="colFirst"><code>protected void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#revokeTenantKey()">revokeTenantKey</a></span>()</code></th>
<td class="colLast">
<div class="block">revokes a tenant key or if no tenant key is specified remove all of them for the
 given tenant.</div>
</td>
</tr>
<tr id="i43" class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#testTenant()">testTenant</a></span>()</code></th>
<td class="colLast">
<div class="block">Check that we can call the set_tenant procedure successfully (which means
 that the
 tenant record exists in the tenants table)</div>
</td>
</tr>
<tr id="i44" class="altColor">
<td class="colFirst"><code>protected void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#updateFhirSchema()">updateFhirSchema</a></span>()</code></th>
<td class="colLast">
<div class="block">Update the FHIR data schema</div>
</td>
</tr>
<tr id="i45" class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#updateJavaBatchSchema()">updateJavaBatchSchema</a></span>()</code></th>
<td class="colLast">
<div class="block">Build and apply the JavaBatch schema changes</div>
</td>
</tr>
<tr id="i46" class="altColor">
<td class="colFirst"><code>protected void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#updateOauthSchema()">updateOauthSchema</a></span>()</code></th>
<td class="colLast">
<div class="block">Build and apply the OAuth schema changes</div>
</td>
</tr>
<tr id="i47" class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#updateProcedures()">updateProcedures</a></span>()</code></th>
<td class="colLast">
<div class="block">Update the stored procedures used by FHIR to insert records
 into the FHIR resource tables</div>
</td>
</tr>
<tr id="i48" class="altColor">
<td class="colFirst"><code>protected boolean</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#updateSchema(com.ibm.fhir.database.utils.model.PhysicalDataModel)">updateSchema</a></span>&#8203;(<a href="../../database/utils/model/PhysicalDataModel.html" title="class in com.ibm.fhir.database.utils.model">PhysicalDataModel</a>&nbsp;pdm)</code></th>
<td class="colLast">
<div class="block">Update the schema associated with the given <a href="../../database/utils/model/PhysicalDataModel.html" title="class in com.ibm.fhir.database.utils.model"><code>PhysicalDataModel</code></a></div>
</td>
</tr>
<tr id="i49" class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#updateSchemas()">updateSchemas</a></span>()</code></th>
<td class="colLast">
<div class="block">Process the schemas configured to be updated</div>
</td>
</tr>
<tr id="i50" class="altColor">
<td class="colFirst"><code>void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#updateVacuumSettings()">updateVacuumSettings</a></span>()</code></th>
<td class="colLast">
<div class="block">updates the vacuum settings for postgres.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a id="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</section>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ FIELD DETAIL =========== -->
<section role="region">
<ul class="blockList">
<li class="blockList"><a id="field.detail">
<!--   -->
</a>
<h3>Field Detail</h3>
<a id="MULTITENANT_FEATURE_ENABLED">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>MULTITENANT_FEATURE_ENABLED</h4>
<pre>public&nbsp;java.util.List&lt;<a href="../../database/utils/model/DbType.html" title="enum in com.ibm.fhir.database.utils.model">DbType</a>&gt; MULTITENANT_FEATURE_ENABLED</pre>
</li>
</ul>
<a id="STORED_PROCEDURE_ENABLED">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>STORED_PROCEDURE_ENABLED</h4>
<pre>public&nbsp;java.util.List&lt;<a href="../../database/utils/model/DbType.html" title="enum in com.ibm.fhir.database.utils.model">DbType</a>&gt; STORED_PROCEDURE_ENABLED</pre>
</li>
</ul>
<a id="PRIVILEGES_FEATURE_ENABLED">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>PRIVILEGES_FEATURE_ENABLED</h4>
<pre>public&nbsp;java.util.List&lt;<a href="../../database/utils/model/DbType.html" title="enum in com.ibm.fhir.database.utils.model">DbType</a>&gt; PRIVILEGES_FEATURE_ENABLED</pre>
</li>
</ul>
<a id="ADMIN_SCHEMANAME">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>ADMIN_SCHEMANAME</h4>
<pre>public static final&nbsp;java.lang.String ADMIN_SCHEMANAME</pre>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../constant-values.html#com.ibm.fhir.schema.app.Main.ADMIN_SCHEMANAME">Constant Field Values</a></dd>
</dl>
</li>
</ul>
<a id="OAUTH_SCHEMANAME">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>OAUTH_SCHEMANAME</h4>
<pre>public static final&nbsp;java.lang.String OAUTH_SCHEMANAME</pre>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../constant-values.html#com.ibm.fhir.schema.app.Main.OAUTH_SCHEMANAME">Constant Field Values</a></dd>
</dl>
</li>
</ul>
<a id="BATCH_SCHEMANAME">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>BATCH_SCHEMANAME</h4>
<pre>public static final&nbsp;java.lang.String BATCH_SCHEMANAME</pre>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../constant-values.html#com.ibm.fhir.schema.app.Main.BATCH_SCHEMANAME">Constant Field Values</a></dd>
</dl>
</li>
</ul>
<a id="DATA_SCHEMANAME">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>DATA_SCHEMANAME</h4>
<pre>public static final&nbsp;java.lang.String DATA_SCHEMANAME</pre>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../constant-values.html#com.ibm.fhir.schema.app.Main.DATA_SCHEMANAME">Constant Field Values</a></dd>
</dl>
</li>
</ul>
</li>
</ul>
</section>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<section role="region">
<ul class="blockList">
<li class="blockList"><a id="constructor.detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a id="&lt;init&gt;()">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>Main</h4>
<pre>public&nbsp;Main()</pre>
</li>
</ul>
</li>
</ul>
</section>
<!-- ============ METHOD DETAIL ========== -->
<section role="region">
<ul class="blockList">
<li class="blockList"><a id="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a id="createConnection()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>createConnection</h4>
<pre class="methodSignature">protected&nbsp;java.sql.Connection&nbsp;createConnection()</pre>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>a created connection to the selected database</dd>
</dl>
</li>
</ul>
<a id="configureConnectionPool()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>configureConnectionPool</h4>
<pre class="methodSignature">protected&nbsp;void&nbsp;configureConnectionPool()</pre>
<div class="block">Create a simple connection pool associated with our data source so that we
 can perform the DDL deployment in parallel</div>
</li>
</ul>
<a id="buildAdminSchemaModel(com.ibm.fhir.database.utils.model.PhysicalDataModel)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>buildAdminSchemaModel</h4>
<pre class="methodSignature">protected&nbsp;void&nbsp;buildAdminSchemaModel&#8203;(<a href="../../database/utils/model/PhysicalDataModel.html" title="class in com.ibm.fhir.database.utils.model">PhysicalDataModel</a>&nbsp;pdm)</pre>
<div class="block">Add the admin schema objects to the <a href="../../database/utils/model/PhysicalDataModel.html" title="class in com.ibm.fhir.database.utils.model"><code>PhysicalDataModel</code></a></div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>pdm</code> - the data model to build</dd>
</dl>
</li>
</ul>
<a id="buildOAuthSchemaModel(com.ibm.fhir.database.utils.model.PhysicalDataModel)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>buildOAuthSchemaModel</h4>
<pre class="methodSignature">protected&nbsp;void&nbsp;buildOAuthSchemaModel&#8203;(<a href="../../database/utils/model/PhysicalDataModel.html" title="class in com.ibm.fhir.database.utils.model">PhysicalDataModel</a>&nbsp;pdm)</pre>
<div class="block">Add the OAuth schema objects to the given <a href="../../database/utils/model/PhysicalDataModel.html" title="class in com.ibm.fhir.database.utils.model"><code>PhysicalDataModel</code></a></div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>pdm</code> - the model to build</dd>
</dl>
</li>
</ul>
<a id="buildJavaBatchSchemaModel(com.ibm.fhir.database.utils.model.PhysicalDataModel)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>buildJavaBatchSchemaModel</h4>
<pre class="methodSignature">protected&nbsp;void&nbsp;buildJavaBatchSchemaModel&#8203;(<a href="../../database/utils/model/PhysicalDataModel.html" title="class in com.ibm.fhir.database.utils.model">PhysicalDataModel</a>&nbsp;pdm)</pre>
<div class="block">Add the JavaBatch schema objects to the given <a href="../../database/utils/model/PhysicalDataModel.html" title="class in com.ibm.fhir.database.utils.model"><code>PhysicalDataModel</code></a></div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>pdm</code> - </dd>
</dl>
</li>
</ul>
<a id="applyModel(com.ibm.fhir.database.utils.model.PhysicalDataModel,com.ibm.fhir.database.utils.api.IDatabaseAdapter,com.ibm.fhir.task.api.ITaskCollector,com.ibm.fhir.database.utils.version.VersionHistoryService)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>applyModel</h4>
<pre class="methodSignature">protected&nbsp;void&nbsp;applyModel&#8203;(<a href="../../database/utils/model/PhysicalDataModel.html" title="class in com.ibm.fhir.database.utils.model">PhysicalDataModel</a>&nbsp;pdm,
                          <a href="../../database/utils/api/IDatabaseAdapter.html" title="interface in com.ibm.fhir.database.utils.api">IDatabaseAdapter</a>&nbsp;adapter,
                          <a href="../../task/api/ITaskCollector.html" title="interface in com.ibm.fhir.task.api">ITaskCollector</a>&nbsp;collector,
                          <a href="../../database/utils/version/VersionHistoryService.html" title="class in com.ibm.fhir.database.utils.version">VersionHistoryService</a>&nbsp;vhs)</pre>
<div class="block">Start the schema object creation tasks and wait for everything to complete</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>pdm</code> - </dd>
<dd><code>adapter</code> - </dd>
<dd><code>collector</code> - </dd>
<dd><code>vhs</code> - </dd>
</dl>
</li>
</ul>
<a id="checkCompatibility()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>checkCompatibility</h4>
<pre class="methodSignature">protected&nbsp;boolean&nbsp;checkCompatibility()</pre>
<div class="block">specific feature to check if it is compatible.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
</dl>
</li>
</ul>
<a id="createSchemas()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>createSchemas</h4>
<pre class="methodSignature">protected&nbsp;void&nbsp;createSchemas()</pre>
<div class="block">Create the schemas</div>
</li>
</ul>
<a id="updateSchemas()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>updateSchemas</h4>
<pre class="methodSignature">protected&nbsp;void&nbsp;updateSchemas()</pre>
<div class="block">Process the schemas configured to be updated</div>
</li>
</ul>
<a id="buildFhirDataSchemaModel(com.ibm.fhir.database.utils.model.PhysicalDataModel)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>buildFhirDataSchemaModel</h4>
<pre class="methodSignature">protected&nbsp;void&nbsp;buildFhirDataSchemaModel&#8203;(<a href="../../database/utils/model/PhysicalDataModel.html" title="class in com.ibm.fhir.database.utils.model">PhysicalDataModel</a>&nbsp;pdm)</pre>
<div class="block">Add FHIR data schema objects to the given <a href="../../database/utils/model/PhysicalDataModel.html" title="class in com.ibm.fhir.database.utils.model"><code>PhysicalDataModel</code></a></div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>pdm</code> - the data model being built</dd>
</dl>
</li>
</ul>
<a id="updateFhirSchema()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>updateFhirSchema</h4>
<pre class="methodSignature">protected&nbsp;void&nbsp;updateFhirSchema()</pre>
<div class="block">Update the FHIR data schema</div>
</li>
</ul>
<a id="updateOauthSchema()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>updateOauthSchema</h4>
<pre class="methodSignature">protected&nbsp;void&nbsp;updateOauthSchema()</pre>
<div class="block">Build and apply the OAuth schema changes</div>
</li>
</ul>
<a id="updateJavaBatchSchema()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>updateJavaBatchSchema</h4>
<pre class="methodSignature">protected&nbsp;void&nbsp;updateJavaBatchSchema()</pre>
<div class="block">Build and apply the JavaBatch schema changes</div>
</li>
</ul>
<a id="updateSchema(com.ibm.fhir.database.utils.model.PhysicalDataModel)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>updateSchema</h4>
<pre class="methodSignature">protected&nbsp;boolean&nbsp;updateSchema&#8203;(<a href="../../database/utils/model/PhysicalDataModel.html" title="class in com.ibm.fhir.database.utils.model">PhysicalDataModel</a>&nbsp;pdm)</pre>
<div class="block">Update the schema associated with the given <a href="../../database/utils/model/PhysicalDataModel.html" title="class in com.ibm.fhir.database.utils.model"><code>PhysicalDataModel</code></a></div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>true if the database is new</dd>
</dl>
</li>
</ul>
<a id="populateResourceTypeAndParameterNameTableEntries(java.lang.Integer)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>populateResourceTypeAndParameterNameTableEntries</h4>
<pre class="methodSignature">protected&nbsp;void&nbsp;populateResourceTypeAndParameterNameTableEntries&#8203;(java.lang.Integer&nbsp;tenantId)</pre>
<div class="block">populates for the given tenantId the RESOURCE_TYPE table.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>tenantId</code> - the mt_id that is used to setup the partition.
            passing in null signals not multi-tenant.</dd>
</dl>
</li>
</ul>
<a id="dropSchema()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>dropSchema</h4>
<pre class="methodSignature">protected&nbsp;void&nbsp;dropSchema()</pre>
<div class="block">Drop all the objects in the admin and data schemas.
 Typically used during development.</div>
</li>
</ul>
<a id="updateProcedures()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>updateProcedures</h4>
<pre class="methodSignature">protected&nbsp;void&nbsp;updateProcedures()</pre>
<div class="block">Update the stored procedures used by FHIR to insert records
 into the FHIR resource tables</div>
</li>
</ul>
<a id="buildCommonModel(com.ibm.fhir.database.utils.model.PhysicalDataModel,boolean,boolean,boolean)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>buildCommonModel</h4>
<pre class="methodSignature">protected&nbsp;void&nbsp;buildCommonModel&#8203;(<a href="../../database/utils/model/PhysicalDataModel.html" title="class in com.ibm.fhir.database.utils.model">PhysicalDataModel</a>&nbsp;pdm,
                                boolean&nbsp;addFhirDataSchema,
                                boolean&nbsp;addOAuthSchema,
                                boolean&nbsp;addJavaBatchSchema)</pre>
<div class="block">Build a common PhysicalDataModel containing all the requested schemas</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>pdm</code> - the model to construct</dd>
<dd><code>addFhirDataSchema</code> - include objects for the FHIR data schema</dd>
<dd><code>addOAuthSchema</code> - include objects for the Liberty OAuth schema</dd>
<dd><code>addJavaBatchSchema</code> - include objects for the Liberty JavaBatch schema</dd>
</dl>
</li>
</ul>
<a id="grantPrivilegesForFhirData()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>grantPrivilegesForFhirData</h4>
<pre class="methodSignature">protected&nbsp;void&nbsp;grantPrivilegesForFhirData()</pre>
<div class="block">Apply grants to the FHIR data schema objects</div>
</li>
</ul>
<a id="grantPrivilegesForOAuth()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>grantPrivilegesForOAuth</h4>
<pre class="methodSignature">protected&nbsp;void&nbsp;grantPrivilegesForOAuth()</pre>
<div class="block">Apply grants to the OAuth schema objects</div>
</li>
</ul>
<a id="grantPrivilegesForBatch()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>grantPrivilegesForBatch</h4>
<pre class="methodSignature">protected&nbsp;void&nbsp;grantPrivilegesForBatch()</pre>
<div class="block">Apply grants to the JavaBatch schema objects</div>
</li>
</ul>
<a id="grantPrivileges()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>grantPrivileges</h4>
<pre class="methodSignature">protected&nbsp;void&nbsp;grantPrivileges()</pre>
<div class="block">Grant the minimum required set of privileges on the FHIR schema objects
 to the grantTo user. All tenant data access is via this user, and is the
 only user the FHIR server itself is configured with.</div>
</li>
</ul>
<a id="isMultitenant()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>isMultitenant</h4>
<pre class="methodSignature">protected&nbsp;boolean&nbsp;isMultitenant()</pre>
<div class="block">Do we want to build the multitenant variant of the schema (currently only supported
 by DB2)</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
</dl>
</li>
</ul>
<a id="addTenantKey()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>addTenantKey</h4>
<pre class="methodSignature">protected&nbsp;void&nbsp;addTenantKey()</pre>
<div class="block">Add a new tenant key so that we can rotate the values (add a
 new key, update config files, then remove the old key). This
 avoids any service interruption.</div>
</li>
</ul>
<a id="checkIfTenantNameAndTenantKeyExists(com.ibm.fhir.database.utils.db2.Db2Adapter,java.lang.String,java.lang.String,boolean)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>checkIfTenantNameAndTenantKeyExists</h4>
<pre class="methodSignature">protected&nbsp;boolean&nbsp;checkIfTenantNameAndTenantKeyExists&#8203;(<a href="../../database/utils/db2/Db2Adapter.html" title="class in com.ibm.fhir.database.utils.db2">Db2Adapter</a>&nbsp;adapter,
                                                      java.lang.String&nbsp;tenantName,
                                                      java.lang.String&nbsp;tenantKey,
                                                      boolean&nbsp;skip)</pre>
<div class="block">checks if tenant name and tenant key exists.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>adapter</code> - the db2 adapter as this is a db2 feature only now</dd>
<dd><code>tenantName</code> - the tenant's name</dd>
<dd><code>tenantKey</code> - tenant key</dd>
<dd><code>skip</code> - whether or not to skip over cases where this tenantName/tenantKey combination already exists</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>indicates if the tenantName/tenantKey exists</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.IllegalArgumentException</code> - if the tenantName/tenantKey combination already exists and the <code>skip</code> argument is false</dd>
</dl>
</li>
</ul>
<a id="allocateTenant()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>allocateTenant</h4>
<pre class="methodSignature">protected&nbsp;void&nbsp;allocateTenant()</pre>
<div class="block">Allocate this tenant, creating new partitions if required.</div>
</li>
</ul>
<a id="checkSchemaForTenant()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>checkSchemaForTenant</h4>
<pre class="methodSignature">protected&nbsp;void&nbsp;checkSchemaForTenant()</pre>
<div class="block">Run a check to make sure that if the tenant already exists its schema
 matches the specified schema. This prevents users from accidentally
 creating a second instance of a tenant in a different schema</div>
</li>
</ul>
<a id="getTenantList()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getTenantList</h4>
<pre class="methodSignature">protected&nbsp;java.util.List&lt;<a href="../control/TenantInfo.html" title="class in com.ibm.fhir.schema.control">TenantInfo</a>&gt;&nbsp;getTenantList()</pre>
<div class="block">Get the list of tenants and the schemas each is currently defined in. Because
 this tenant-schema mapping isn't stored directly, it has to be inferred by
 looking up the schema from one of the tables we know should exist. The schema
 name may therefore be null if the tenant record (in FHIR_ADMIN.TENANTS) exists,
 but all the tables from that schema have been dropped.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
</dl>
</li>
</ul>
<a id="refreshTenants()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>refreshTenants</h4>
<pre class="methodSignature">protected&nbsp;void&nbsp;refreshTenants()</pre>
<div class="block">Make sure all the tables has a partition created for the configured tenant</div>
</li>
</ul>
<a id="listTenants()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>listTenants</h4>
<pre class="methodSignature">protected&nbsp;void&nbsp;listTenants()</pre>
<div class="block">List the tenants currently configured</div>
</li>
</ul>
<a id="testTenant()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>testTenant</h4>
<pre class="methodSignature">protected&nbsp;void&nbsp;testTenant()</pre>
<div class="block">Check that we can call the set_tenant procedure successfully (which means
 that the
 tenant record exists in the tenants table)</div>
</li>
</ul>
<a id="getTenantInfo()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getTenantInfo</h4>
<pre class="methodSignature">protected&nbsp;<a href="../control/TenantInfo.html" title="class in com.ibm.fhir.schema.control">TenantInfo</a>&nbsp;getTenantInfo()</pre>
</li>
</ul>
<a id="freezeTenant()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>freezeTenant</h4>
<pre class="methodSignature">protected&nbsp;<a href="../control/TenantInfo.html" title="class in com.ibm.fhir.schema.control">TenantInfo</a>&nbsp;freezeTenant()</pre>
<div class="block">Mark the tenant so that it can no longer be accessed (this prevents
 the SET_TENANT method from authenticating the tenantName/tenantKey
 pair, so the SV_TENANT_ID variable never gets set).</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the TenantInfo associated with the tenant</dd>
</dl>
</li>
</ul>
<a id="dropTenant()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>dropTenant</h4>
<pre class="methodSignature">protected&nbsp;void&nbsp;dropTenant()</pre>
<div class="block">Deallocate this tenant, dropping all the related partitions. This needs to be
 idempotent because there are steps which must be run in separate transactions
 (due to how Db2 handles detaching partitions). This is further complicated by
 referential integrity constraints in the schema. See:
 - https://www.ibm.com/support/knowledgecenter/SSEPGG_11.5.0/com.ibm.db2.luw.admin.partition.doc/doc/t0021576.html

 The workaround described in the above link is:
 // Change the RI constraint to informational:
 1. ALTER TABLE child ALTER FOREIGN KEY fk NOT ENFORCED;

 2. ALTER TABLE parent DETACH PARTITION p0 INTO TABLE pdet;

 3. SET INTEGRITY FOR child OFF;

 // Change the RI constraint back to enforced:
 4. ALTER TABLE child ALTER FOREIGN KEY fk ENFORCED;

 5. SET INTEGRITY FOR child ALL IMMEDIATE UNCHECKED;
 6. Assuming that the CHILD table does not have any dependencies on partition P0,
 7. and that no updates on the CHILD table are permitted until this UOW is complete,
 no RI violation is possible during this UOW.

 COMMIT WORK;

 Unfortunately, #7 above essentially requires that all writes cease until the
 UOW is completed and the integrity is enabled again on all the child (leaf)
 tables. Of course, this could be relaxed if the application is trusted not
 to mess up the referential integrity...which we know to be true for the
 FHIR server persistence layer.

 If the risk is deemed too high, tenant removal should be performed in a
 maintenance window.</div>
</li>
</ul>
<a id="dropDetachedPartitionTables()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>dropDetachedPartitionTables</h4>
<pre class="methodSignature">protected&nbsp;void&nbsp;dropDetachedPartitionTables()</pre>
<div class="block">Drop any tables which have previously been detached. The detach process is asynchronous,
 so this is a sort of garbage collection, sweeping up cruft left in the database.</div>
</li>
</ul>
<a id="dropDetachedPartitionTables(com.ibm.fhir.database.utils.model.PhysicalDataModel,com.ibm.fhir.schema.control.TenantInfo)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>dropDetachedPartitionTables</h4>
<pre class="methodSignature">protected&nbsp;void&nbsp;dropDetachedPartitionTables&#8203;(<a href="../../database/utils/model/PhysicalDataModel.html" title="class in com.ibm.fhir.database.utils.model">PhysicalDataModel</a>&nbsp;pdm,
                                           <a href="../control/TenantInfo.html" title="class in com.ibm.fhir.schema.control">TenantInfo</a>&nbsp;tenantInfo)</pre>
<div class="block">Drop any tables which have previously been detached. Once all tables have been
 dropped, we go on to drop the tablespace. If the tablespace drop is successful,
 we know the cleanup is complete so we can update the tenant status accordingly</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>pdm</code> - </dd>
<dd><code>tenantInfo</code> - </dd>
</dl>
</li>
</ul>
<a id="detachTenantPartitions(com.ibm.fhir.database.utils.model.PhysicalDataModel,com.ibm.fhir.schema.control.TenantInfo)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>detachTenantPartitions</h4>
<pre class="methodSignature">protected&nbsp;void&nbsp;detachTenantPartitions&#8203;(<a href="../../database/utils/model/PhysicalDataModel.html" title="class in com.ibm.fhir.database.utils.model">PhysicalDataModel</a>&nbsp;pdm,
                                      <a href="../control/TenantInfo.html" title="class in com.ibm.fhir.schema.control">TenantInfo</a>&nbsp;tenantInfo)</pre>
<div class="block">Temporarily suspend RI so that tables which are the subject of foreign
 key relationships can have their partitions dropped. A bit frustrating
 to have to go through this, because the child table partition will be
 detached before the parent anyway, so theoretically this workaround
 shouldn't be necessary.
 ALTER TABLE child ALTER FOREIGN KEY fk NOT ENFORCED;
 ALTER TABLE parent DETACH PARTITION p0 INTO TABLE pdet;
 SET INTEGRITY FOR child OFF;
 ALTER TABLE child ALTER FOREIGN KEY fk ENFORCED;
 SET INTEGRITY FOR child ALL IMMEDIATE UNCHECKED;</div>
</li>
</ul>
<a id="deleteTenantMeta()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>deleteTenantMeta</h4>
<pre class="methodSignature">protected&nbsp;void&nbsp;deleteTenantMeta()</pre>
<div class="block">Delete all the metadata associated with the named tenant.</div>
</li>
</ul>
<a id="revokeTenantKey()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>revokeTenantKey</h4>
<pre class="methodSignature">protected&nbsp;void&nbsp;revokeTenantKey()</pre>
<div class="block">revokes a tenant key or if no tenant key is specified remove all of them for the
 given tenant.</div>
</li>
</ul>
<a id="parseArgs(java.lang.String[])">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>parseArgs</h4>
<pre class="methodSignature">protected&nbsp;void&nbsp;parseArgs&#8203;(java.lang.String[]&nbsp;args)</pre>
<div class="block">Parse the command-line arguments, building up the environment and
 establishing
 the run-list</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>args</code> - </dd>
</dl>
</li>
</ul>
<a id="loadPropertyFile(java.lang.String)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>loadPropertyFile</h4>
<pre class="methodSignature">public&nbsp;void&nbsp;loadPropertyFile&#8203;(java.lang.String&nbsp;filename)</pre>
<div class="block">Read the properties from the given file</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>filename</code> - </dd>
</dl>
</li>
</ul>
<a id="addProperty(java.lang.String)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>addProperty</h4>
<pre class="methodSignature">public&nbsp;void&nbsp;addProperty&#8203;(java.lang.String&nbsp;pair)</pre>
<div class="block">Parse the given key=value string and add to the properties being collected</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>pair</code> - </dd>
</dl>
</li>
</ul>
<a id="applyDataMigrationForV0010()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>applyDataMigrationForV0010</h4>
<pre class="methodSignature">protected&nbsp;void&nbsp;applyDataMigrationForV0010()</pre>
<div class="block">Perform the special data migration steps required for the V0010 version of the schema</div>
</li>
</ul>
<a id="applyDataMigrationForV0014()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>applyDataMigrationForV0014</h4>
<pre class="methodSignature">protected&nbsp;void&nbsp;applyDataMigrationForV0014()</pre>
</li>
</ul>
<a id="backfillResourceChangeLog()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>backfillResourceChangeLog</h4>
<pre class="methodSignature">protected&nbsp;void&nbsp;backfillResourceChangeLog()</pre>
<div class="block">Backfill the RESOURCE_CHANGE_LOG table if it is empty</div>
</li>
</ul>
<a id="backfillResourceChangeLogDb2(com.ibm.fhir.schema.control.TenantInfo)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>backfillResourceChangeLogDb2</h4>
<pre class="methodSignature">protected&nbsp;void&nbsp;backfillResourceChangeLogDb2&#8203;(<a href="../control/TenantInfo.html" title="class in com.ibm.fhir.schema.control">TenantInfo</a>&nbsp;ti)</pre>
<div class="block">backfill the resource_change_log table if it is empty</div>
</li>
</ul>
<a id="updateVacuumSettings()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>updateVacuumSettings</h4>
<pre class="methodSignature">public&nbsp;void&nbsp;updateVacuumSettings()</pre>
<div class="block">updates the vacuum settings for postgres.</div>
</li>
</ul>
<a id="process()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>process</h4>
<pre class="methodSignature">protected&nbsp;void&nbsp;process()</pre>
<div class="block">Process the requested operation</div>
</li>
</ul>
<a id="getExitStatus()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getExitStatus</h4>
<pre class="methodSignature">protected&nbsp;int&nbsp;getExitStatus()</pre>
<div class="block">Get the program exit status from the environment</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
</dl>
</li>
</ul>
<a id="logStatusMessage(int)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>logStatusMessage</h4>
<pre class="methodSignature">protected&nbsp;void&nbsp;logStatusMessage&#8203;(int&nbsp;status)</pre>
<div class="block">Write a final status message - useful for QA to review when checking the
 output</div>
</li>
</ul>
<a id="main(java.lang.String[])">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>main</h4>
<pre class="methodSignature">public static&nbsp;void&nbsp;main&#8203;(java.lang.String[]&nbsp;args)</pre>
<div class="block">Main entry point</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>args</code> - </dd>
</dl>
</li>
</ul>
</li>
</ul>
</section>
</li>
</ul>
</div>
</div>
</main>
<!-- ========= END OF CLASS DATA ========= -->
<footer role="contentinfo">
<nav role="navigation">
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a id="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/Main.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
</ul>
<div class="aboutLanguage"><a href="/FHIR" class="bx--header__name" target="_parent"><span>IBM</span>&nbsp;FHIRÂ®&nbsp;Server</a></div>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../index.html?com/ibm/fhir/schema/app/Main.html" target="_top">Frames</a></li>
<li><a href="Main.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a id="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</nav>
<p class="legalCopy"><small>Copyright 2019, 2022. <a href="http://www.ibm.com">IBM Corporation<a><br></br>FHIR&reg; is the registered trademark of HL7 and is used with the permission of HL7.</small></p>
</footer>
</body>
</html>
