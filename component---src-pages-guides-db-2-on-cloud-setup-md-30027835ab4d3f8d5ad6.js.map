{"version":3,"sources":["webpack:///./src/pages/guides/DB2OnCloudSetup.md"],"names":["_frontmatter","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","props","mdxType","parentName","isMDXComponent"],"mappings":"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","file":"component---src-pages-guides-db-2-on-cloud-setup-md-30027835ab4d3f8d5ad6.js","sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/runner/work/FHIR/FHIR/fhir/docs/node_modules/gatsby-theme-carbon/src/templates/Default.js\";\nexport const _frontmatter = {};\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h2>{`Using Db2 for persistence`}</h2>\n    <p>{`This document guides a developer or administrator through the steps necessary to setup and configure `}<a parentName=\"p\" {...{\n        \"href\": \"https://cloud.ibm.com/catalog/services/db2\"\n      }}>{`IBM Db2 on IBM Cloud`}</a>{` as a persistence layer for the IBM FHIR Server.`}</p>\n    <h3><strong parentName=\"h3\">{`Create a Db2 instance`}</strong></h3>\n    <ol>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Log in to your IBM Cloud account `}<a parentName=\"p\" {...{\n            \"href\": \"https://cloud.ibm.com/\"\n          }}>{`Link`}</a>{`.`}</p>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Click `}<inlineCode parentName=\"p\">{`Create resource`}</inlineCode>{`.`}</p>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Choose `}<a parentName=\"p\" {...{\n            \"href\": \"https://cloud.ibm.com/catalog/services/db2\"\n          }}>{`Db2`}</a>{`.`}</p>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Select the Pricing Plan`}</p>\n        <ul parentName=\"li\">\n          <li parentName=\"ul\">{`The IBM FHIR Server does not support using the `}<em parentName=\"li\">{`Lite`}</em>{` plan.`}</li>\n        </ul>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Create `}<inlineCode parentName=\"p\">{`Create`}</inlineCode></p>\n      </li>\n    </ol>\n    <p>{`Your instance is now creating or created.`}</p>\n    <h3><strong parentName=\"h3\">{`Scale the instance`}</strong></h3>\n    <p>{`Depending on the plan you choose, you may want to scale the instance after it has been created (e.g. 4 cores, 16GB). The instance can be scaled more than once, so it doesn’t matter if you don’t get the sizing right first time.`}</p>\n    <p>{`Note:`}</p>\n    <ol>\n      <li parentName=\"ol\">{`The scaling of the instance requires a service restart.`}</li>\n      <li parentName=\"ol\">{`The instance CPU/Memory are scalable up and down. The storage in only scaled up.`}</li>\n    </ol>\n    <h3><strong parentName=\"h3\">{`Create the administrator credential`}</strong></h3>\n    <p>{`The administrator is `}<inlineCode parentName=\"p\">{`BLUADMIN`}</inlineCode>{` but you need to create a credential.`}</p>\n    <ol>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Navigate to the Db2 instance you created.`}</p>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Click on the `}<inlineCode parentName=\"p\">{`Service credentials`}</inlineCode>{` panel.`}</p>\n        <ul parentName=\"li\">\n          <li parentName=\"ul\">{`If the list of service credentials is empty, create a new one.`}\n            <ol parentName=\"li\">\n              <li parentName=\"ol\">{`Click `}<inlineCode parentName=\"li\">{`New credential (+)`}</inlineCode></li>\n              <li parentName=\"ol\">{`Enter the Name. Any name works for example, `}<inlineCode parentName=\"li\">{`ibm-fhir-server-db2`}</inlineCode>{`.`}</li>\n              <li parentName=\"ol\">{`Click Add`}</li>\n            </ol>\n          </li>\n        </ul>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Access the credential, select View Credentials. The entry you just created looks like the following block of JSON(the secrets are blanked out here):`}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-json\"\n          }}>{`{\n    \"hostname\": \"dashdb-txn-***-***********.services.dal.bluemix.net\",\n    \"password\": \"bluadmin-password-very-secret\",\n    \"https_url\": \"https://dashdb-txn-***-************.services.dal.bluemix.net:8443\",\n    \"port\": 50000,\n    \"ssldsn\": \"DATABASE=BLUDB;HOSTNAME=dashdb-txn-***-************.services.dal.bluemix.net;PORT=50001;PROTOCOL=TCPIP;UID=bluadmin;PWD=bluadmin-password-very-secret;Security=SSL;\",\n    \"host\": \"dashdb-txn-***-************.services.dal.bluemix.net\",\n    \"jdbcurl\": \"jdbc:db2://dashdb-txn-***-************.services.dal.bluemix.net:50000/BLUDB\",\n    \"uri\": \"db2://bluadmin:bluadmin-password-very-secret@dashdb-txn-***-************.services.dal.bluemix.net:50000/BLUDB\",\n    \"db\": \"BLUDB\",\n    \"dsn\": \"DATABASE=BLUDB;HOSTNAME=dashdb-txn-***-************.services.dal.bluemix.net;PORT=50000;PROTOCOL=TCPIP;UID=bluadmin;PWD=bluadmin-password-very-secret;\",\n    \"username\": \"bluadmin\",\n    \"ssljdbcurl\": \"jdbc:db2://dashdb-txn-***-************.services.dal.bluemix.net:50001/BLUDB:sslConnection=true;\"\n}\n`}</code></pre>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Save these details for later, as these properties are needed to deploy and manage the IBM FHIR Server schema.`}</p>\n      </li>\n    </ol>\n    <p>{`For improved security, the `}<strong parentName=\"p\">{`BLUADMIN`}</strong>{` user should only be used to deploy the schema objects (tables, indexes, stored procedures etc) and administer the database, NOT for connecting from the fhir-server application.`}</p>\n    <h3><strong parentName=\"h3\">{`Add the FHIRSERVER user and API key`}</strong></h3>\n    <p>{`Following the least-privilege principle, the IBM FHIR server itself does not use `}<strong parentName=\"p\">{`BLUADMIN`}</strong>{`. The IBM FHIR server uses an API Key associated with an `}<a parentName=\"p\" {...{\n        \"href\": \"https://cloud.ibm.com/iam/serviceids\"\n      }}>{`IAM Service Id`}</a>{`. The IAM Service Id is mapped to a Db2 user which is granted explicit privileges to the tables and stored procedures.`}</p>\n    <p>{`The IBM FHIR Server uses the access flow:`}</p>\n    <ol>\n      <li parentName=\"ol\">{`Read API Key and the tenant key from the fhir-server-config.json`}</li>\n      <li parentName=\"ol\">{`Connect to Db2 to access authenticated data using IAM`}</li>\n      <li parentName=\"ol\">{`Confirm tenant-key to access authorized data`}</li>\n    </ol>\n    <p>{`The steps to create the API key are:`}</p>\n    <ol>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`On the IBM Cloud console, select `}<inlineCode parentName=\"p\">{`Manage`}</inlineCode>{` > `}<inlineCode parentName=\"p\">{`Access (IAM)`}</inlineCode>{`.`}</p>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Select the `}<a parentName=\"p\" {...{\n            \"href\": \"https://cloud.ibm.com/iam/serviceids\"\n          }}>{`Service IDs panel`}</a>{`.`}</p>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Click `}<inlineCode parentName=\"p\">{`Create (+)`}</inlineCode></p>\n        <ol parentName=\"li\">\n          <li parentName=\"ol\">{`Enter a meaningful name, such as `}<inlineCode parentName=\"li\">{`fhir-service-id`}</inlineCode>{`.`}</li>\n          <li parentName=\"ol\">{`Enter a description, such as `}<inlineCode parentName=\"li\">{`for instance db2-ho`}</inlineCode>{`.`}</li>\n          <li parentName=\"ol\">{`Click the `}<inlineCode parentName=\"li\">{`Create`}</inlineCode>{`.`}</li>\n        </ol>\n        <ul parentName=\"li\">\n          <li parentName=\"ul\">{`Note (1): If you have already created the entry, click the entry.`}</li>\n          <li parentName=\"ul\">{`Note (2): You may have to wait for the table to populate.`}</li>\n        </ul>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Select the `}<inlineCode parentName=\"p\">{`API keys`}</inlineCode>{` tab.`}</p>\n        <ul parentName=\"li\">\n          <li parentName=\"ul\">{`Note: This tab is not the same `}<inlineCode parentName=\"li\">{`IBM Cloud API keys`}</inlineCode>{` on the left.`}</li>\n        </ul>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`To create an API Key, select `}<inlineCode parentName=\"p\">{`Create (+)`}</inlineCode>{`.`}</p>\n        <ol parentName=\"li\">\n          <li parentName=\"ol\">{`Enter a name for the api key, for example, `}<inlineCode parentName=\"li\">{`fhir-server-api`}</inlineCode>{`.`}</li>\n          <li parentName=\"ol\">{`Click `}<inlineCode parentName=\"li\">{`Create`}</inlineCode>{`.`}</li>\n          <li parentName=\"ol\">{`Copy or download the key.`}</li>\n        </ol>\n        <ul parentName=\"li\">\n          <li parentName=\"ul\">{`Note: if you don’t retain a copy, don’t panic - you can simply delete the API key and create a new one. API keys are designed to support additions and deletions, so you add as many as you need and delete others for any reason.`}</li>\n        </ul>\n      </li>\n    </ol>\n    <p>{`This API key is used in the database configuration section of the `}<inlineCode parentName=\"p\">{`fhir-server-config.json`}</inlineCode>{` file.`}</p>\n    <p>{`Before the API key can be used, you need to create a Db2 user and associate it with the new ServiceId.`}</p>\n    <ol>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Navigate to the `}<a parentName=\"p\" {...{\n            \"href\": \"https://cloud.ibm.com/resources\"\n          }}>{`Resources`}</a>{` page`}</p>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Find and click on your IBM Db2 on Cloud instance.`}</p>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Click on Manage.`}</p>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Click on Open Console.`}</p>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Click `}<inlineCode parentName=\"p\">{`SETTINGS`}</inlineCode>{` > `}<inlineCode parentName=\"p\">{`Manage Users`}</inlineCode>{`.`}</p>\n        <ul parentName=\"li\">\n          <li parentName=\"ul\">{`Note: If you do not see `}<inlineCode parentName=\"li\">{`Manage Users`}</inlineCode>{`, you are probably using a `}<a parentName=\"li\" {...{\n              \"href\": \"https://www.ibm.com/support/knowledgecenter/SS6NHC/com.ibm.swg.im.dashdb.security.doc/doc/iam.html\"\n            }}>{`non-IAM instance`}</a>{`. To confirm:`}\n            <ol parentName=\"li\">\n              <li parentName=\"ol\">{`Click Run Sql`}</li>\n              <li parentName=\"ol\">{`Enter the SQL`}\n                <pre parentName=\"li\"><code parentName=\"pre\" {...{\n                    \"className\": \"language-sql\"\n                  }}>{`SELECT CASE WHEN VALUE = 'IBMIAMauth' THEN 1 ELSE 0 END AS IAM_ENABLED FROM SYSIBMADM.DBMCFG WHERE NAME = 'srvcon_gssplugin_list'\n`}</code></pre>\n              </li>\n              <li parentName=\"ol\">{`You see `}<inlineCode parentName=\"li\">{`0`}</inlineCode>{` if not IAM enabled.`}</li>\n            </ol>\n          </li>\n        </ul>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Click Add. A panel opens on the right-hand side.`}</p>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Select Add IBMid User at the top.`}</p>\n        <ul parentName=\"li\">\n          <li parentName=\"ul\">\n            <p parentName=\"li\">{`User ID: FHIRSERVER`}</p>\n          </li>\n          <li parentName=\"ul\">\n            <p parentName=\"li\">{`IBMid: paste the service id (not service id name) from the Service Id created previously. To get that navigate to the service id you created earlier and click on `}<inlineCode parentName=\"p\">{`Details`}</inlineCode>{` link (top right side next to Actions Menu). A panel opens on the right-hand side which contains ID. This ID needs to be used as IBMid value.`}</p>\n          </li>\n          <li parentName=\"ul\">\n            <p parentName=\"li\">{`Note (1): The page forces the value to lower-case, so `}<inlineCode parentName=\"p\">{`ServiceId`}</inlineCode>{` becomes `}<inlineCode parentName=\"p\">{`serviceid`}</inlineCode>{`. Don’t be alarmed, it still works.`}</p>\n          </li>\n          <li parentName=\"ul\">\n            <p parentName=\"li\">{`Note (2): Do NOT select Administrator. One should follow the least-privelege principal for the FHIRSERVER user.`}</p>\n          </li>\n        </ul>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Click `}<inlineCode parentName=\"p\">{`Create`}</inlineCode>{`.`}</p>\n      </li>\n    </ol>\n    <p>{`You are now able to connect to the database as the FHIRSERVER user using only the API key created above.`}</p>\n    <h3><strong parentName=\"h3\">{`Testing the connection`}</strong></h3>\n    <p>{`The `}<a parentName=\"p\" {...{\n        \"href\": \"https://repo1.maven.org/maven2/com/ibm/db2/jcc/11.5.0.0/jcc-11.5.0.0.jar\"\n      }}>{`Db2 driver`}</a>{` is able to execute a connectivity test to check the configuration of the combo of API-key/Service-Id/Db2-User-Id.`}</p>\n    <ol>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Copy the command to your code editor`}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-bash\"\n          }}>{`java -cp /path/to/db2jcc4.jar com.ibm.db2.jcc.DB2Jcc  -url \"jdbc:db2://<DB2-HOSTNAME>:50001/BLUDB:apiKey=<API-KEY>;securityMechanism=15;sslConnection=true;sslTrustStoreLocation=/path/to/truststore.jks;sslTrustStorePassword=<TRUSTSTORE-PASSWORD>;\"\n`}</code></pre>\n        <ul parentName=\"li\">\n          <li parentName=\"ul\">{`Note: Don’t forget the trailing `}<inlineCode parentName=\"li\">{`;`}</inlineCode>{` in the URL. Some of the documented examples don’t include it, but it is required in order for the connection to work, although this may be fixed in a future driver release. This only affects this test URL, not the actual FHIR server configuration.`}</li>\n        </ul>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Replace the following values with your service details:`}</p>\n        <ul parentName=\"li\">\n          <li parentName=\"ul\">\n            <p parentName=\"li\"><inlineCode parentName=\"p\">{`/path/to/db2jcc4.jar`}</inlineCode>{` : replace with the path to your driver jar.`}</p>\n          </li>\n          <li parentName=\"ul\">\n            <p parentName=\"li\"><inlineCode parentName=\"p\">{`<DB-HOSTNAME>`}</inlineCode>{`: the hostname of your Db2 service from the Service Credentials page`}</p>\n          </li>\n          <li parentName=\"ul\">\n            <p parentName=\"li\"><inlineCode parentName=\"p\">{`<API-KEY>`}</inlineCode>{`: the API key value created in the previous section`}</p>\n          </li>\n          <li parentName=\"ul\">\n            <p parentName=\"li\"><inlineCode parentName=\"p\">{`<TRUSTSTORE-PASSWORD>`}</inlineCode>{`: the password for your truststore`}</p>\n          </li>\n          <li parentName=\"ul\">\n            <p parentName=\"li\">{`Note: When using an API Key, no username needs to be provided. This is because the API Key maps to a ServiceId, and that ServiceId is mapped to the Db2 user.`}</p>\n          </li>\n        </ul>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Run in your favorite terminal, and you should see no errors in the output. You should see output like:`}</p>\n      </li>\n    </ol>\n    <pre><code parentName=\"pre\" {...{}}>{`[jcc][10516][13709]Test Connection Successful.\n`}</code></pre>\n    <h3><strong parentName=\"h3\">{`Deploy the IBM FHIR Server schema`}</strong></h3>\n    <p>{`Now that you’ve created the database and credentials, use the `}<inlineCode parentName=\"p\">{`fhir-persistence-schema`}</inlineCode>{` utility to deploy the IBM FHIR Server schema:`}</p>\n    <ol>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`download the `}<inlineCode parentName=\"p\">{`fhir-persistence-schema`}</inlineCode>{` cli jar from the corresponding project release: `}<a parentName=\"p\" {...{\n            \"href\": \"https://github.com/IBM/FHIR/releases\"\n          }}>{`https://github.com/IBM/FHIR/releases`}</a></p>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`create a properties file named db2.properties with the db2 connection info from IBM Cloud; for example:`}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{}}>{`db.host=dashdb-txn-***-***********.services.dal.bluemix.net\ndb.port=50001\ndb.database=BLUDB\nuser=bluadmin\npassword=bluadmin-password-very-secret\nsslConnection=true\n`}</code></pre>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`execute the following commands:`}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-sh\"\n          }}>{`java -jar schema/fhir-persistence-schema-*-cli.jar \\\\\n  --prop-file db2.properties --schema-name FHIRDATA --create-schemas\njava -jar schema/fhir-persistence-schema-*-cli.jar \\\\\n  --prop-file db2.properties --schema-name FHIRDATA --update-schema --pool-size 2\njava -jar schema/fhir-persistence-schema-*-cli.jar \\\\\n  --prop-file db2.properties --schema-name FHIRDATA --grant-to FHIRSERVER --pool-size 2\njava -jar schema/fhir-persistence-schema-*-cli.jar \\\\\n  --prop-file db2.properties --schema-name FHIRDATA --allocate-tenant default --pool-size 2\n`}</code></pre>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`note the tenantKey from the allocate-tenant step above; this will be needed to configure the IBM FHIR Server datasource in the next step`}</p>\n      </li>\n    </ol>\n    <p>{`For more information on using the fhir-persistence-schema cli jar, see `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/IBM/FHIR/tree/master/fhir-persistence-schema/README.md\"\n      }}>{`https://github.com/IBM/FHIR/tree/master/fhir-persistence-schema/README.md`}</a>{`.`}</p>\n    <h3><strong parentName=\"h3\">{`Configuring an IBM FHIR Server datasource`}</strong></h3>\n    <p>{`The IBM FHIR Server uses a proxy datasource mechanism, allowing new datasources to be added at runtime without requiring a (Liberty Profile) server restart. To configure a FHIR tenant datasource using an API-KEY, use the following template:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-json\"\n      }}>{`        \"persistence\": {\n            \"datasources\": {\n                \"default\": {\n                    \"tenantKey\": \"\",\n                    \"hints\" : {\n                        \"search.reopt\": \"ONCE\"\n                    },\n                    \"type\": \"db2\",\n                    \"connectionProperties\": {\n                        \"serverName\": \"dashdb-txn-***-************.services.dal.bluemix.net\",\n                        \"portNumber\": 50001,\n                        \"databaseName\": \"BLUDB\",\n                        \"apiKey\": \"<API-KEY>\",\n                        \"securityMechanism\": 15,\n                        \"pluginName\": \"IBMIAMauth\",\n                        \"currentSchema\": \"FHIRDATA\",\n                        \"driverType\": 4,\n                        \"sslConnection\": true,\n                        \"sslTrustStoreLocation\": \"resources/security/dbTruststore.jks\",\n                        \"sslTrustStorePassword\": \"change-password\"\n                    }\n                }\n            }\n        }\n`}</code></pre>\n    <p>{`The persistence configuration is stored in the `}<inlineCode parentName=\"p\">{`fhir-server-config.json`}</inlineCode>{` in the tenant and default configuration folders.`}</p>\n    <p>{`Since release 4.3.2 you can use the `}<inlineCode parentName=\"p\">{`search.reopt`}</inlineCode>{` query optimizer hint (shown above) to improve the performance of certain search queries involving multiple search parameters. This optimization is currently only available for Db2. Valid values are “ALWAYS” and “ONCE”. See Db2 documentation for `}<inlineCode parentName=\"p\">{`REOPT`}</inlineCode>{` for more details.`}</p>\n    <h4>{`Mapping from IBM Db2 on Cloud endpoint credentials`}</h4>\n    <p>{`This section explains how to populate the FHIR datasource from IBM Db2 on Cloud configuration details from an example configuration:`}</p>\n    <p>{`Use the following table to populate your datasource.`}</p>\n    <table>\n      <thead parentName=\"table\">\n        <tr parentName=\"thead\">\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`IBM FHIR Server Configuration`}</th>\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Description`}</th>\n        </tr>\n      </thead>\n      <tbody parentName=\"table\">\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`serverName`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`from the credential object select `}<inlineCode parentName=\"td\">{`hostname`}</inlineCode></td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`portNumber`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`from the credential object select  `}<inlineCode parentName=\"td\">{`port`}</inlineCode></td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`databaseName`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`from the credential object select  `}<inlineCode parentName=\"td\">{`db`}</inlineCode>{`, generally always `}<inlineCode parentName=\"td\">{`BLUDB`}</inlineCode></td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`apiKey`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`from the created user in the assigned to the `}<inlineCode parentName=\"td\">{`fhiruser`}</inlineCode>{` group. Reference Section `}<strong parentName=\"td\">{`FHIRSERVER User and API Key`}</strong></td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`securityMechanism`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`15`}</inlineCode>{` generally set to 15 to trigger the `}<inlineCode parentName=\"td\">{`apiKey`}</inlineCode>{` use with IBM Cloud`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`pluginName`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`IBMIAMauth`}</inlineCode>{` fixed for use with the IBM Cloud`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`currentSchema`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`the schema name of your deployed tenant Schema, for instance `}<inlineCode parentName=\"td\">{`FHIRDATA`}</inlineCode></td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`driverType`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`4`}</inlineCode>{`, always JDBC Type-4`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`sslConnection`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`true`}</inlineCode>{`, if you are using IBM Cloud`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`sslTrustStoreLocation`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Local server path to the truststore, `}<inlineCode parentName=\"td\">{`resources/security/dbTruststore.jks`}</inlineCode></td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`sslTrustStorePassword`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`The password to the truststore`}</td>\n        </tr>\n      </tbody>\n    </table>\n    <ul>\n      <li parentName=\"ul\">{`Reference the section `}<strong parentName=\"li\">{`Create the Administrator Credential`}</strong>{` to see an example.`}</li>\n    </ul>\n    <p>{`Note, no username properties are given, because the authentication module only requires the API-KEY.`}</p>\n    <h3><strong parentName=\"h3\">{`Configuring a BulkData’s Liberty Datasource with API key`}</strong></h3>\n    <p>{`The IBM FHIR Server Bulk Data modules utilize Java Batch (JSR-352) from the Liberty Profile feature - `}<inlineCode parentName=\"p\">{`batch-1.0`}</inlineCode>{`. The batch feature is configured to use Db2 as follows:`}</p>\n    <ol>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Create a Db2 user (e.g. FHIRBATCH)`}</p>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Associate it with a ServiceId (no need to create an Administration user, a simple user has sufficient privileges) using the same procedure you followed for the fhir-server ServiceId user.`}</p>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Using a valid API-KEY for the given ServiceId, configure a new datasource and the Java Batch persistence layer as follows:`}</p>\n      </li>\n    </ol>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-xml\"\n      }}>{`    <dataSource id=\"fhirbatchDS\" jndiName=\"jdbc/fhirbatchDB\">\n        <jdbcDriver libraryRef=\"fhirSharedLib\"/>\n        <properties.db2.jcc\n            serverName=\"dashdb-txn-***-************.services.dal.bluemix.net\"\n            portNumber=\"50001\"\n            apiKey=\"<API-KEY>\"\n            securityMechanism=\"15\"\n            pluginName=\"IBMIAMauth\"\n            databaseName=\"BLUDB\"\n            currentSchema=\"JBATCH\"\n            driverType=\"4\" sslConnection=\"true\" sslTrustStoreLocation=\"resources/security/dbTruststore.jks\" sslTrustStorePassword=\"<TRUSTSTORE-PASSWORD>\"/>\n    </dataSource>\n\n    <batchPersistence jobStoreRef=\"BatchDatabaseStore\" />\n    <databaseStore id=\"BatchDatabaseStore\" dataSourceRef=\"fhirbatchDS\" schema=\"JBATCH\" tablePrefix=\"\" />\n`}</code></pre>\n    <ul>\n      <li parentName=\"ul\">{`Note: The Java Batch is configured in `}<inlineCode parentName=\"li\">{`batchDs.xml`}</inlineCode>{` and included from the IBM FHIR Server’s `}<inlineCode parentName=\"li\">{`server.xml`}</inlineCode>{` which is installed to `}<inlineCode parentName=\"li\">{`{wlp}/usr/server/fhir-server`}</inlineCode>{`.`}</li>\n      <li parentName=\"ul\">{`Note: While this feature is not required, it’s best to configure this datasource while configuring the main datasource.`}</li>\n    </ul>\n    <h3><strong parentName=\"h3\">{`SSL Certificate`}</strong></h3>\n    <p>{`The Db2 certificate should be added to the Liberty Profile truststore. `}<em parentName=\"p\">{`Be sure to use the same Java runtime that Liberty Profile uses when manipulating any keystores.`}</em></p>\n    <h3><strong parentName=\"h3\">{`Encrypt Secrets`}</strong></h3>\n    <p>{`All passwords including apiKey values should be encrypted using the Liberty Profile securityUtility.`}</p>\n    <h1>{`Appendix: Db2 Lite Plan`}</h1>\n    <p>{`The Lite plan is not supported for development and evaluation.`}</p>\n    <ul>\n      <li parentName=\"ul\">{`The schema size is larger than the available space.`}</li>\n      <li parentName=\"ul\">{`Concurrent Connections: The Lite plan has a limit of 5 concurrent connections, and the IBM FHIR Server `}<inlineCode parentName=\"li\">{`fhirProxyDataSource`}</inlineCode>{` needs to be updated to avoid failures. One should update the server.xml connectionManager with maxPoolSize - `}<inlineCode parentName=\"li\">{`<connectionManager maxPoolSize=\"5\"/>`}</inlineCode>{`.  `}</li>\n      <li parentName=\"ul\">{`The instance is not enabled with IAM, and you may use the `}<inlineCode parentName=\"li\">{`Service Credentials`}</inlineCode>{` that are created to connect to configure the datasource.`}</li>\n    </ul>\n    <h1><strong parentName=\"h1\">{`References`}</strong></h1>\n    <ul>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://cloud.ibm.com/docs/services/Db2onCloud?topic=Db2onCloud-db_details_cxn_creds\"\n        }}>{`Db2 on Cloud: Database details and connection credentials`}</a></li>\n    </ul>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"sourceRoot":""}