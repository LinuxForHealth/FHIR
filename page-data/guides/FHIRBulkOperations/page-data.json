{"componentChunkName":"component---src-pages-guides-fhir-bulk-operations-md","path":"/guides/FHIRBulkOperations/","result":{"pageContext":{"frontmatter":{"layout":"post","title":"IBM FHIR Server Bulk Data Guide","description":"IBM FHIR Server Bulk Data Guide","date":"2022-01-20T00:00:00.000Z","permalink":"/FHIRBulkOperations/"},"relativePagePath":"/guides/FHIRBulkOperations.md","titleType":"append","MdxNode":{"id":"b06d9e87-1e85-55fe-9b08-b18e3887c721","children":[],"parent":"0073be3a-6970-5cf0-9507-200463b7199e","internal":{"content":"---\nlayout: post\ntitle: IBM FHIR Server Bulk Data Guide\ndescription: IBM FHIR Server Bulk Data Guide\ndate:   2022-01-20\npermalink: /FHIRBulkOperations/\n---\n\n# Overview\n\nThe IBM FHIR Server has extended operations for Bulk Data `$import`, `$export` and `$bulkdata-status`, which are implemented in the modules: \n\n|Module|Description|\n|---|---|\n|[fhir-operation-bulkdata](https://github.com/IBM/FHIR/tree/main/operation/fhir-operation-bulkdata)|Implements the FHIR Operations `$import` and `$export` and translate bulk data requests into JSR352 Java Batch jobs|\n|[fhir-bulkdata-webapp](https://github.com/IBM/FHIR/tree/main/fhir-bulkdata-webapp)|Standalone web application to process bulk data requests as JSR352 Java Batch jobs|\n\nThe IBM FHIR Server bulk data module configuration is described in more detail at the [FHIR Server Users Guide](https://ibm.github.io/FHIR/guides/FHIRServerUsersGuide/#410-bulk-data-operations).\n\n## Export Operation: $export\nThe `$export` operation uses three OperationDefinition: \n- [System](http://hl7.org/fhir/uv/bulkdata/STU1/OperationDefinition-export.html) - Export data from the server. Exports to an S3-compatible data store.\n- [Patient](http://hl7.org/fhir/uv/bulkdata/STU1/OperationDefinition-patient-export.html) - Obtain a set of resources pertaining to all patients. Exports to an S3-compatible data store.\n- [Group](http://hl7.org/fhir/uv/bulkdata/STU1/OperationDefinition-group-export.html) - Obtain a set of resources pertaining to patients in a specific Group. Only supports static membership; does not resolve inclusion/exclusion criteria.\n\nThe export is in the ndjson format.\n\n### **$export: Create a Bulk Data Request**\nTo create an export request, the IBM FHIR Server requires the body fields of the request object to be a FHIR Resource `Parameters` JSON Object.  The request must be posted to the server using `POST`. Each request is limited to a single resource type in each imported or referenced file.\n\n#### Example Request - GET\nThe following is a request to export data to the IBM COS endpoint from the IBM FHIR Server using GET.\n\n```sh\ncurl -k -u \"fhiruser:change-password\" -H \"Content-Type: application/fhir+json\" \\\n    -X GET 'https://localhost:9443/fhir-server/api/v4/$export?_outputFormat=application/fhir%2Bndjson&_type=Patient' -v\n```\n\n#### Example Request - POST\nThe following is a request to export data to the IBM COS endpoint from the IBM FHIR Server using POST and Parameters resource.\n\n```sh\ncurl -k -u \"fhiruser:change-password\" -H \"Content-Type: application/fhir+json\" \\\n     -X POST 'https://localhost:9443/fhir-server/api/v4/$export' \\\n     -d '{\n    \"resourceType\": \"Parameters\",\n    \"id\": \"e33a6a4e-29b5-4f62-a3e9-8d09f50ae54d\",\n    \"parameter\": [\n        {\n            \"name\": \"_outputFormat\",\n            \"valueString\": \"application/fhir+ndjson\"\n        },\n        {\n            \"name\": \"_since\",\n            \"valueInstant\": \"2019-01-01T08:21:26.94-04:00\"\n        },\n        {\n            \"name\": \"_type\",\n            \"valueString\": \"Observation,Condition\"\n        }\n    ]\n}'\n```\n\n## Import Operation: $import\n\nThe `$import` operation is a system-level operation invoked at `[base]/$import`. The Import Operation uses a custom crafted OperationDefinition [link](https://github.com/IBM/FHIR/blob/main/operation/fhir-operation-bulkdata/src/main/resources/import.json), which follows the proposal from [Smart-on-FHIR: import.md](https://github.com/smart-on-fhir/bulk-import/blob/main/import.md).\n\n### **$import: Create a Bulk Data Request**\nTo create an import request, the IBM FHIR Server requires the body fields of the request object to be a FHIR Resource `Parameters` JSON Object.  The request must be posted to the server using `POST`. Each input url in the request is limited to a single resource type.\n\nThe IBM FHIR Server limits the number of inputs per each `$import` request based on `fhirServer/bulkdata/maxInputPerRequest`, which defaults to 5 input entries.\n\nThe IBM FHIR Server supports `storageDetail.type` with the value of `ibm-cos`, `https`, `azure-blob` and `aws-s3`.\n\nTo import using the $import on https, one must additionally configure the `fhirServer/bulkdata/validBaseUrls`. For example, if one stores bulkdata on https://test-url.ibm.com/folder1 and https://test-url.ibm.com/folder2 you must specify both baseUrls. Please refer to the [IBM FHIR Server User's Guide](https://ibm.github.io/FHIR/guides/FHIRServerUsersGuide#410-bulk-data-operations). Please note, the BulkData Operations do not support import from `http://`.\n\n#### Example Request\nThe following is a request to load data from the IBM COS endpoint into the IBM FHIR Server.\n\n``` sh\ncurl -k -v -X POST -u \"fhiruser:change-password\" \\\n    -H 'Content-Type: application/fhir+json' 'https://localhost:9443/fhir-server/api/v4/$import' \\\n    -d '{\n    \"resourceType\": \"Parameters\",\n    \"id\": \"30321130-5032-49fb-be54-9b8b82b2445a\",\n    \"parameter\": [\n        {\n            \"name\": \"inputFormat\",\n            \"valueString\": \"application/fhir+ndjson\"\n        },\n        {\n            \"name\": \"inputSource\",\n            \"valueUri\": \"https://localhost:9443/source-fhir-server\"\n        },\n        {\n            \"name\": \"input\",\n            \"part\": [\n                {\n                    \"name\": \"type\",\n                    \"valueString\": \"Patient\"\n                },\n                {\n                    \"name\": \"url\",\n                    \"valueUrl\": \"test-import.ndjson\"\n                }\n            ]\n        },\n        {\n            \"name\": \"storageDetail\",\n            \"valueString\": \"ibm-cos\"\n        }\n    ]\n}'\n```\n\n#### Example Response\nThe response body is populated only on error, the response status code is 202 and the `content-location` is populated with the polling location in a response header:\n\n``` sh\nContent-Location: https://localhost:9443/fhir-server/api/v4/$bulkdata-status?job=JKyViJ5Y0zcqQ2Uv1aBSMw%3D%3D\n```\n\n## Status Operation: $bulkdata-status\nThe `StatusOperation` is a BulkData Management endpoint, which uses the `Content-Location`'s http query parameter value for job to manage the Bulk Data job request.\n\nThere are two custom features - *Poll Job* and *Delete Job*.\n\n### **$bulkdata-status: Poll Job**\nThe response returned is 202 if the job is queued or not yet complete.\n\nNote: If the job is stopped, e.g, due to shutdown of the IBM FHIR Server where the job is running the bulkdata job, then upon polling the status of the bulkdata job, the server restarts the JavaBatch job, and the response to the client is Accepted: 202.\nThe response returned is 200 if the job is completed.\n\nThe following is a sample path to the exported ndjson file, the full path can be found in the response to the polling location request after the export request (please refer to the FHIR BulkDataAccess specification for details).  \n\n`.../exports/6xjd4M8afi6Xo95eYv7zPxBqSCoOEFywZLoqH1QBtbw=/Patient_1.ndjson`\n\n#### Example\n- Request\n```sh\ncurl -k -v -u \"fhiruser:change-password\" \\\n    'https://localhost:9443/fhir-server/api/v4/$bulkdata-status?job=FvHrLGPv0oKZNyLzBnY5iA%3D%3D'\n```\n- Response for `$import` or `$export` not yet complete\nThe response code is 202.\n\n- Response for $export upon completion\n```json\n{\n\"transactionTime\": \"2020/01/20 16:53:41.160 -0500\",\n\"request\": \"/$export?_type=Patient\",\n\"requiresAccessToken\": false,\n\"output\" : [\n  { \"type\" : \"AllergyIntolerance\",\n      \"url\": \"https://s3.us-south.cloud-object-storage.appdomain.cloud/fhir-bulkimexport-connectathon/6SfXzbGvYl1nTjGbf5qeqJDFNjyljiGdKxXEJb4yJn8=/AllergyIntolerance_1.ndjson\",\n    \"count\": 20},\n  { \"type\" : \"AllergyIntolerance\",\n      \"url\": \"https://s3.us-south.cloud-object-storage.appdomain.cloud/fhir-bulkimexport-connectathon/6SfXzbGvYl1nTjGbf5qeqJDFNjyljiGdKxXEJb4yJn8=/AllergyIntolerance_2.ndjson\",\n    \"count\": 8},\n  { \"type\" : \"Observation\",\n      \"url\": \"https://s3.us-south.cloud-object-storage.appdomain.cloud/fhir-bulkimexport-connectathon/6SfXzbGvYl1nTjGbf5qeqJDFNjyljiGdKxXEJb4yJn8=/Observation_1.ndjson\",\n    \"count\": 234},\n  { \"type\" : \"Observation\",\n      \"url\": \"https://s3.us-south.cloud-object-storage.appdomain.cloud/fhir-bulkimexport-connectathon/6SfXzbGvYl1nTjGbf5qeqJDFNjyljiGdKxXEJb4yJn8=/Observation_2.ndjson\",\n    \"count\": 81}]\n}\n```\n\n- Response for $import upon completion\n```json\n{\n    \"transactionTime\": \"2020-04-28T13:13:01.366-04:00\",\n    \"request\": \"$import\",\n    \"requiresAccessToken\": false,\n    \"output\": [\n        {\n            \"type\": \"OperationOutcome\",\n            \"url\": \"test-import.ndjson_oo_success.ndjson\",\n            \"count\": 3\n        }\n    ],\n    \"error\": [\n        {\n            \"type\": \"OperationOutcome\",\n            \"url\": \"test-import.ndjson_oo_errors.ndjson\",\n            \"count\": 0\n        }\n    ]\n}\n```\n\n### **$bulkdata-status: Delete Job**\nThe Bulk Data Request is deleted using the Content-Location and executing the `DELETE` method. The deletion of a job is asynchronous - the job is stopped and subsequently deleted.  The data is not cleaned up from the destination storage location - e.g. partially imported data or partially exported data is not cleaned up. \n\n- Request\n```sh\ncurl -k -v -u \"fhiruser:change-password\" -X DELETE \\\n    'https://localhost:9443/fhir-server/api/v4/$bulkdata-status?job=k%2Fd8cTAU%2BUeVEwqURPZ3oA%3D%3D'\n```\n\n- Response\nThe response returned is 202 if the job deletion is not yet complete.\nThe response returned is 200 if the job deletion is completed.\n\n## Notes\n1. For status codes, if there is an error on the server a 500 is returned, or if there is a client request error, a 400 is returned. \n1. There are integration tests which exercise the various features of the Bulk Data Operations - `ImportOperationTest` and `ExportOperationTest`.  These integration tests are useful for testing the IBM FHIR Server, and may be useful for developers wanting to build their own tests. \n1. Depending on the access policy of your export location, one may download the content using a command like `curl -o Patient_1.ndjson https://example.cloud.local/fhir-downloads/path-path/Patient_1.ndjson`.\n1. The use of Basic Authentication `fhiruser:change-password` is expected to be changed to match your environment authentication routine.\n","type":"Mdx","contentDigest":"eb905070a74facec922c6c6512ab8c81","owner":"gatsby-plugin-mdx","counter":113,"fieldOwners":{"slug":"gatsby-plugin-slug"}},"frontmatter":{"title":"IBM FHIR Server Bulk Data Guide","layout":"post","description":"IBM FHIR Server Bulk Data Guide","date":"2022-01-20T00:00:00.000Z","permalink":"/FHIRBulkOperations/"},"exports":{},"rawBody":"---\nlayout: post\ntitle: IBM FHIR Server Bulk Data Guide\ndescription: IBM FHIR Server Bulk Data Guide\ndate:   2022-01-20\npermalink: /FHIRBulkOperations/\n---\n\n# Overview\n\nThe IBM FHIR Server has extended operations for Bulk Data `$import`, `$export` and `$bulkdata-status`, which are implemented in the modules: \n\n|Module|Description|\n|---|---|\n|[fhir-operation-bulkdata](https://github.com/IBM/FHIR/tree/main/operation/fhir-operation-bulkdata)|Implements the FHIR Operations `$import` and `$export` and translate bulk data requests into JSR352 Java Batch jobs|\n|[fhir-bulkdata-webapp](https://github.com/IBM/FHIR/tree/main/fhir-bulkdata-webapp)|Standalone web application to process bulk data requests as JSR352 Java Batch jobs|\n\nThe IBM FHIR Server bulk data module configuration is described in more detail at the [FHIR Server Users Guide](https://ibm.github.io/FHIR/guides/FHIRServerUsersGuide/#410-bulk-data-operations).\n\n## Export Operation: $export\nThe `$export` operation uses three OperationDefinition: \n- [System](http://hl7.org/fhir/uv/bulkdata/STU1/OperationDefinition-export.html) - Export data from the server. Exports to an S3-compatible data store.\n- [Patient](http://hl7.org/fhir/uv/bulkdata/STU1/OperationDefinition-patient-export.html) - Obtain a set of resources pertaining to all patients. Exports to an S3-compatible data store.\n- [Group](http://hl7.org/fhir/uv/bulkdata/STU1/OperationDefinition-group-export.html) - Obtain a set of resources pertaining to patients in a specific Group. Only supports static membership; does not resolve inclusion/exclusion criteria.\n\nThe export is in the ndjson format.\n\n### **$export: Create a Bulk Data Request**\nTo create an export request, the IBM FHIR Server requires the body fields of the request object to be a FHIR Resource `Parameters` JSON Object.  The request must be posted to the server using `POST`. Each request is limited to a single resource type in each imported or referenced file.\n\n#### Example Request - GET\nThe following is a request to export data to the IBM COS endpoint from the IBM FHIR Server using GET.\n\n```sh\ncurl -k -u \"fhiruser:change-password\" -H \"Content-Type: application/fhir+json\" \\\n    -X GET 'https://localhost:9443/fhir-server/api/v4/$export?_outputFormat=application/fhir%2Bndjson&_type=Patient' -v\n```\n\n#### Example Request - POST\nThe following is a request to export data to the IBM COS endpoint from the IBM FHIR Server using POST and Parameters resource.\n\n```sh\ncurl -k -u \"fhiruser:change-password\" -H \"Content-Type: application/fhir+json\" \\\n     -X POST 'https://localhost:9443/fhir-server/api/v4/$export' \\\n     -d '{\n    \"resourceType\": \"Parameters\",\n    \"id\": \"e33a6a4e-29b5-4f62-a3e9-8d09f50ae54d\",\n    \"parameter\": [\n        {\n            \"name\": \"_outputFormat\",\n            \"valueString\": \"application/fhir+ndjson\"\n        },\n        {\n            \"name\": \"_since\",\n            \"valueInstant\": \"2019-01-01T08:21:26.94-04:00\"\n        },\n        {\n            \"name\": \"_type\",\n            \"valueString\": \"Observation,Condition\"\n        }\n    ]\n}'\n```\n\n## Import Operation: $import\n\nThe `$import` operation is a system-level operation invoked at `[base]/$import`. The Import Operation uses a custom crafted OperationDefinition [link](https://github.com/IBM/FHIR/blob/main/operation/fhir-operation-bulkdata/src/main/resources/import.json), which follows the proposal from [Smart-on-FHIR: import.md](https://github.com/smart-on-fhir/bulk-import/blob/main/import.md).\n\n### **$import: Create a Bulk Data Request**\nTo create an import request, the IBM FHIR Server requires the body fields of the request object to be a FHIR Resource `Parameters` JSON Object.  The request must be posted to the server using `POST`. Each input url in the request is limited to a single resource type.\n\nThe IBM FHIR Server limits the number of inputs per each `$import` request based on `fhirServer/bulkdata/maxInputPerRequest`, which defaults to 5 input entries.\n\nThe IBM FHIR Server supports `storageDetail.type` with the value of `ibm-cos`, `https`, `azure-blob` and `aws-s3`.\n\nTo import using the $import on https, one must additionally configure the `fhirServer/bulkdata/validBaseUrls`. For example, if one stores bulkdata on https://test-url.ibm.com/folder1 and https://test-url.ibm.com/folder2 you must specify both baseUrls. Please refer to the [IBM FHIR Server User's Guide](https://ibm.github.io/FHIR/guides/FHIRServerUsersGuide#410-bulk-data-operations). Please note, the BulkData Operations do not support import from `http://`.\n\n#### Example Request\nThe following is a request to load data from the IBM COS endpoint into the IBM FHIR Server.\n\n``` sh\ncurl -k -v -X POST -u \"fhiruser:change-password\" \\\n    -H 'Content-Type: application/fhir+json' 'https://localhost:9443/fhir-server/api/v4/$import' \\\n    -d '{\n    \"resourceType\": \"Parameters\",\n    \"id\": \"30321130-5032-49fb-be54-9b8b82b2445a\",\n    \"parameter\": [\n        {\n            \"name\": \"inputFormat\",\n            \"valueString\": \"application/fhir+ndjson\"\n        },\n        {\n            \"name\": \"inputSource\",\n            \"valueUri\": \"https://localhost:9443/source-fhir-server\"\n        },\n        {\n            \"name\": \"input\",\n            \"part\": [\n                {\n                    \"name\": \"type\",\n                    \"valueString\": \"Patient\"\n                },\n                {\n                    \"name\": \"url\",\n                    \"valueUrl\": \"test-import.ndjson\"\n                }\n            ]\n        },\n        {\n            \"name\": \"storageDetail\",\n            \"valueString\": \"ibm-cos\"\n        }\n    ]\n}'\n```\n\n#### Example Response\nThe response body is populated only on error, the response status code is 202 and the `content-location` is populated with the polling location in a response header:\n\n``` sh\nContent-Location: https://localhost:9443/fhir-server/api/v4/$bulkdata-status?job=JKyViJ5Y0zcqQ2Uv1aBSMw%3D%3D\n```\n\n## Status Operation: $bulkdata-status\nThe `StatusOperation` is a BulkData Management endpoint, which uses the `Content-Location`'s http query parameter value for job to manage the Bulk Data job request.\n\nThere are two custom features - *Poll Job* and *Delete Job*.\n\n### **$bulkdata-status: Poll Job**\nThe response returned is 202 if the job is queued or not yet complete.\n\nNote: If the job is stopped, e.g, due to shutdown of the IBM FHIR Server where the job is running the bulkdata job, then upon polling the status of the bulkdata job, the server restarts the JavaBatch job, and the response to the client is Accepted: 202.\nThe response returned is 200 if the job is completed.\n\nThe following is a sample path to the exported ndjson file, the full path can be found in the response to the polling location request after the export request (please refer to the FHIR BulkDataAccess specification for details).  \n\n`.../exports/6xjd4M8afi6Xo95eYv7zPxBqSCoOEFywZLoqH1QBtbw=/Patient_1.ndjson`\n\n#### Example\n- Request\n```sh\ncurl -k -v -u \"fhiruser:change-password\" \\\n    'https://localhost:9443/fhir-server/api/v4/$bulkdata-status?job=FvHrLGPv0oKZNyLzBnY5iA%3D%3D'\n```\n- Response for `$import` or `$export` not yet complete\nThe response code is 202.\n\n- Response for $export upon completion\n```json\n{\n\"transactionTime\": \"2020/01/20 16:53:41.160 -0500\",\n\"request\": \"/$export?_type=Patient\",\n\"requiresAccessToken\": false,\n\"output\" : [\n  { \"type\" : \"AllergyIntolerance\",\n      \"url\": \"https://s3.us-south.cloud-object-storage.appdomain.cloud/fhir-bulkimexport-connectathon/6SfXzbGvYl1nTjGbf5qeqJDFNjyljiGdKxXEJb4yJn8=/AllergyIntolerance_1.ndjson\",\n    \"count\": 20},\n  { \"type\" : \"AllergyIntolerance\",\n      \"url\": \"https://s3.us-south.cloud-object-storage.appdomain.cloud/fhir-bulkimexport-connectathon/6SfXzbGvYl1nTjGbf5qeqJDFNjyljiGdKxXEJb4yJn8=/AllergyIntolerance_2.ndjson\",\n    \"count\": 8},\n  { \"type\" : \"Observation\",\n      \"url\": \"https://s3.us-south.cloud-object-storage.appdomain.cloud/fhir-bulkimexport-connectathon/6SfXzbGvYl1nTjGbf5qeqJDFNjyljiGdKxXEJb4yJn8=/Observation_1.ndjson\",\n    \"count\": 234},\n  { \"type\" : \"Observation\",\n      \"url\": \"https://s3.us-south.cloud-object-storage.appdomain.cloud/fhir-bulkimexport-connectathon/6SfXzbGvYl1nTjGbf5qeqJDFNjyljiGdKxXEJb4yJn8=/Observation_2.ndjson\",\n    \"count\": 81}]\n}\n```\n\n- Response for $import upon completion\n```json\n{\n    \"transactionTime\": \"2020-04-28T13:13:01.366-04:00\",\n    \"request\": \"$import\",\n    \"requiresAccessToken\": false,\n    \"output\": [\n        {\n            \"type\": \"OperationOutcome\",\n            \"url\": \"test-import.ndjson_oo_success.ndjson\",\n            \"count\": 3\n        }\n    ],\n    \"error\": [\n        {\n            \"type\": \"OperationOutcome\",\n            \"url\": \"test-import.ndjson_oo_errors.ndjson\",\n            \"count\": 0\n        }\n    ]\n}\n```\n\n### **$bulkdata-status: Delete Job**\nThe Bulk Data Request is deleted using the Content-Location and executing the `DELETE` method. The deletion of a job is asynchronous - the job is stopped and subsequently deleted.  The data is not cleaned up from the destination storage location - e.g. partially imported data or partially exported data is not cleaned up. \n\n- Request\n```sh\ncurl -k -v -u \"fhiruser:change-password\" -X DELETE \\\n    'https://localhost:9443/fhir-server/api/v4/$bulkdata-status?job=k%2Fd8cTAU%2BUeVEwqURPZ3oA%3D%3D'\n```\n\n- Response\nThe response returned is 202 if the job deletion is not yet complete.\nThe response returned is 200 if the job deletion is completed.\n\n## Notes\n1. For status codes, if there is an error on the server a 500 is returned, or if there is a client request error, a 400 is returned. \n1. There are integration tests which exercise the various features of the Bulk Data Operations - `ImportOperationTest` and `ExportOperationTest`.  These integration tests are useful for testing the IBM FHIR Server, and may be useful for developers wanting to build their own tests. \n1. Depending on the access policy of your export location, one may download the content using a command like `curl -o Patient_1.ndjson https://example.cloud.local/fhir-downloads/path-path/Patient_1.ndjson`.\n1. The use of Basic Authentication `fhiruser:change-password` is expected to be changed to match your environment authentication routine.\n","fileAbsolutePath":"/home/runner/work/FHIR/FHIR/fhir/docs/src/pages/guides/FHIRBulkOperations.md","fields":{"slug":"/guides/FHIRBulkOperations"}}}},"staticQueryHashes":["1364590287","2102389209","2102389209","227138135","227138135","2456312558","2746626797","2746626797","3018647132","3018647132","3906363820","3906363820","768070550"]}